<!DOCTYPE html>
  <html>
    <head>
      <meta charset="UTF-8">
	  <link rel="stylesheet" href="css/style.css"/>
      <title>Paint</title>
    </head>
    <body>
		<main>
			<h1>Modification de photos</h1>
			<section class="container">
				<label for="file" class="label-file">Choisir une image</label>
				<input id="file" class="input-file" type="file">
				<button class="option" id="grey_btn">Grey level render</button>
				<select class="option" id="select_color">
					<option selected>Choisir ...</option>
					<option>red</option>
					<option>blue</option>
					<option>green</option>
				</select>
				<button class="option" id="save">Sauvegarder</button>
			</section>
			<div class="image">
				<img id="og_img" src=""/>
				<canvas id="img"/>
			</div>
		</main>
    </body>

<script>
	var changeColor = function(color){
        img.drawImage(og_img, 0, 0);
        var imgData = img.getImageData(0,0,img.canvas.width, img.canvas.height);
        var data = imgData.data;

        switch(color){
            case "red":
                for(var i=0; i<data.length; i+=4) {
                    data[i+1] = 0;
                    data[i+2] = 0
                }
                img.putImageData(imgData, 0, 0);
                break;

            case "green":
                for(var i=0; i<data.length; i+=4) {
                    data[i] = 0;
                    data[i+2] = 0
                }
                img.putImageData(imgData, 0, 0);
                break;

            case "blue":
                for(var i=0; i<data.length; i+=4) {
                    data[i+1] = 0;
                    data[i] = 0
                }
                img.putImageData(imgData, 0, 0);
                break;

			case "grey":
                for(var i=0; i<data.length; i+=4) {
                    var red = data[i];
                    var green = data[i+1];
                    var blue = data[i+2];

                    data[i] = red*0.3 + green*0.59 + blue*0.11;
                    data[i+1] = red*0.3 + green*0.59 + blue*0.11;
                    data[i+2] = red*0.3 + green*0.59 + blue*0.11;
                }
                img.putImageData(imgData, 0, 0);
                break;
        }
	}


    var fileChooser = document.getElementById('file');
    var og_img = document.getElementById('og_img');
    var img = document.getElementById('img').getContext('2d');
    var greyBtn = document.getElementById('grey_btn');
    var colorSelect = document.getElementById('select_color');
	var btnSave = document.getElementById('save');
    fileChooser.addEventListener('change', function(){
        if (this.files && this.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                og_img.setAttribute('src', e.target.result);
            }
            reader.readAsDataURL(this.files[0]);
        };
    });

    og_img.onload = function(e){
        img.canvas.width = og_img.width;
        img.canvas.height = og_img.height;
        img.drawImage(og_img, 0, 0);
	}
    greyBtn.addEventListener('click', function(){
        changeColor("grey");
	})
	colorSelect.addEventListener('change', function(){
		changeColor(colorSelect.value);
	})
	
	btnSave.onclick = function(){
		
    }
	
	
	btnSave.addEventListener("submit", function(event) {
		event.preventDefault();
		canvas.toBlobHD(function(blob) {
			saveAs(
				  blob
				, (canvas_filename.value || canvas_filename.placeholder) + ".png"
			);
		}, "image/png");
	}, false);
	
	
</script>
  </html>